<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø§Ù†ØªØ¸Ø± Ù„Ø­Ø¸Ø©...</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f6f8;
      color: #333;
      text-align: center;
      padding-top: 100px;
    }
    .loader {
      border: 6px solid #f3f3f3;
      border-top: 6px solid #3498db;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>

  <h2>ğŸš€ ÙŠØªÙ… ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ùƒ...</h2>
  <div class="loader"></div>
  <p>ÙŠØªÙ… Ø§Ù„Ø¢Ù† ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ ÙˆÙ†ÙˆØ¹ Ø¬Ù‡Ø§Ø²Ùƒ ÙˆØªÙˆÙ‚ÙŠØªÙƒ...</p>

  <script>
    function getTimePeriod() {
      const hour = new Date().getHours();
      if (hour >= 5 && hour < 12) return "morning";
      if (hour >= 12 && hour < 20) return "evening";
      return "night";
    }

    function detectDeviceType() {
      const ua = navigator.userAgent.toLowerCase();
      if (ua.includes("android")) return "android";
      if (ua.includes("iphone") || ua.includes("ipad") || ua.includes("ipod")) return "ios";
      if (ua.includes("windows") || ua.includes("mac") || ua.includes("linux")) return "pc";
      return "pc";
    }

    function getCountryAndRedirect() {
      const device = detectDeviceType();
      const time = getTimePeriod();

      fetch("https://ipinfo.io/json?token=9b6d7272dd1191")
        .then(res => res.json())
        .then(data => {
          const country = data.country ? data.country.toLowerCase() : "??";

          // Ø¬Ù„Ø¨ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù…Ù† Google Sheets
          const params = new URLSearchParams({
            country: country,
            time: time,
            device: device
          });

          fetch(`https://script.google.com/macros/s/AKfycbxjO2jsY9jChR_uv_s8uyI90qfBrzNJRRsvmwyOug2sws-cRHOBcPxi3A83aPDECrSl/exec?${params}`)
            .then(response => response.text())
            .then(link => {
              // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Google Sheets
              fetch("https://script.google.com/macros/s/AKfycbxjO2jsY9jChR_uv_s8uyI90qfBrzNJRRsvmwyOug2sws-cRHOBcPxi3A83aPDECrSl/exec", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  country: country,
                  device: device,
                  time: time,
                  link: link
                })
              });

              // Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¨Ø¹Ø¯ 2 Ø«Ø§Ù†ÙŠØ©
              setTimeout(() => {
                if (link && link.startsWith("http")) {
                  window.location.href = link;
                } else {
                  document.body.innerHTML = `<h2>âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±Ø§Ø¨Ø· Ù…Ù†Ø§Ø³Ø¨</h2><p>ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Google Sheets.</p>`;
                }
              }, 2000);
            });
        })
        .catch(err => {
          document.body.innerHTML = `<h2>âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹</h2><p>${err}</p>`;
        });
    }

    // ØªÙ†ÙÙŠØ° Ø§Ù„ÙˆØ¸ÙŠÙØ©
    getCountryAndRedirect();
  </script>

</body>
</html>

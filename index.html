<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</title>
  <style>
    body { font-family: Arial; text-align: center; padding: 50px; background: #f4f4f4; }
    h1 { font-size: 22px; }
    .loading { font-size: 16px; color: gray; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>ğŸ” Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨ÙŠØ§Ù†Ø§ØªÙƒ...</h1>
  <div class="loading" id="status">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...</div>

  <script>
    async function detectDevice() {
      const ua = navigator.userAgent.toLowerCase();
      if (/android/.test(ua)) return "android";
      if (/iphone|ipad|ipod/.test(ua)) return "ios";
      if (/windows|linux|mac/.test(ua)) return "pc";
      return "unknown";
    }

    function getTimePeriod() {
      const hour = new Date().getHours();
      if (hour >= 5 && hour < 12) return "morning";
      if (hour >= 12 && hour < 20) return "evening";
      return "night";
    }

    async function getCountry() {
      try {
        const res = await fetch("https://ipinfo.io/json?token=9b6d7272dd1191");
        const data = await res.json();
        return data.country?.toLowerCase() || "??";
      } catch (e) {
        return "??";
      }
    }

    async function main() {
      const device = await detectDevice();
      const time = getTimePeriod();
      const country = await getCountry();
      const status = document.getElementById("status");
      status.innerText = `ğŸŒ Ø§Ù„Ø¯ÙˆÙ„Ø©: ${country} | ğŸ’» Ø§Ù„Ø¬Ù‡Ø§Ø²: ${device} | â° Ø§Ù„ÙˆÙ‚Øª: ${time}`;

      // Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø¬Ù„Ø¨ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù…Ù† Google Sheets
      const getUrl = "https://script.google.com/macros/s/AKfycbzusaDC2Gi-KiqA_QX3qsTTQ-jKCH76RTpo-iaIDtvTa8OHVELvXx0CXV4qNb8h1X7p/exec";
      const fullUrl = `${getUrl}?country=${country}&time=${time}&device=${device}`;

      try {
        const response = await fetch(fullUrl);
        const finalLink = await response.text();

        // Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Google Sheets Ù„Ù„ØªØ³Ø¬ÙŠÙ„
        await fetch(getUrl, {
          method: "POST",
          body: JSON.stringify({
            country: country,
            device: device,
            time: time,
            link: finalLink
          }),
          headers: { "Content-Type": "application/json" }
        });

        // Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¨Ø¹Ø¯ 2 Ø«Ø§Ù†ÙŠØ©
        setTimeout(() => {
          if (finalLink.startsWith("http")) {
            window.location.href = finalLink;
          } else {
            status.innerText = "âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø§Ø¨Ø· Ù…Ø·Ø§Ø¨Ù‚ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.";
          }
        }, 2000);
      } catch (e) {
        status.innerText = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©.";
      }
    }

    main();
  </script>
</body>
</html>
